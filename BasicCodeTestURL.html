<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<script type='text/javascript'>
	var timerStarted;
	function lagCounter(fromPage,currentPage){
		var lagTime = Date.now() - timerStarted;
		console.log("From " + fromPage + " to " + currentPage, "Lag time in mSec: "+ lagTime);
		timerStarted = Date.now();
	}
	function domObserver(eleSelector) {
		try {
			timerStarted = Date.now();
			
			snapInPrechatForm = document.querySelector(".modalContainer  .dockableContainer .sidebarBody .activeFeature .featureBody .embeddedServiceSidebarState .prechatUI");
			snapInWaiting = document.querySelector(".dockableContainer .embeddedServiceLiveAgentStateWaiting .waitingStateContainer");
			snapInQueueAssignment = document.querySelector(".dockableContainer .queuePositionContent.queuePositionWaiting.embeddedServiceLiveAgentQueuePosition");
			snapInChatStarted = document.querySelector(".dockableContainer .activeFeature .embeddedServiceLiveAgentStateChat .chasitorControls .chasitorText");
			snapInChatEnded = document.querySelector(".dockableContainer .activeFeature .embeddedServiceLiveAgentStateChat .endChatContainer");//Fix for defect 7030965
			snapInConfirmationDialoug = document.querySelector(".dockableContainer .activeFeature .stateBody .dialogState .dialogTextContainer");
			snapInhelpBtnDisabled = document.querySelector(".embeddedServiceHelpButton .helpButton .helpButtonDisabled");
			snapInhelpBtnEnabled = document.querySelector(".embeddedServiceHelpButton .helpButton .helpButtonEnabled");
			if (snapInPrechatForm)
				snapInCurrentPage = "snapInPrechatForm";
			else if (snapInWaiting)
				snapInCurrentPage = "snapInWaiting";
			else if (snapInQueueAssignment)
				snapInCurrentPage = "snapInQueueAssignment";
			else if (snapInChatStarted)
				snapInCurrentPage = "snapInChatStarted";
			else if (snapInChatEnded)
				snapInCurrentPage = "snapInChatEnded";
			else if (snapInConfirmationDialoug)
				snapInCurrentPage = "snapInConfirmationDialoug";
			else if (snapInhelpBtnDisabled) {
				snapInCurrentPage = "snapInhelpBtnDisabled";
			} else if (snapInhelpBtnEnabled)
				snapInhelpBtnEnabled = "snapInhelpBtnEnabled";
			else
				snapInCurrentPage = "ScriptStarted";
			var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
			var attributeChangeCallback = function (mutations) {
				mutations.forEach(function (mutation) {
					if (mutation.addedNodes.length > 0) {
						snapInPrechatForm = document.querySelector(".modalContainer  .dockableContainer .sidebarBody .activeFeature .featureBody .embeddedServiceSidebarState .prechatUI");
						snapInWaiting = document.querySelector(".dockableContainer .embeddedServiceLiveAgentStateWaiting .waitingStateContainer");
						snapInChatStarted = document.querySelector(".dockableContainer .activeFeature .embeddedServiceLiveAgentStateChat .chasitorControls .chasitorText");
						snapInChatEnded = document.querySelector(".dockableContainer .activeFeature .embeddedServiceLiveAgentStateChat .endChatContainer");//Fix for defect 7030965
						snapInConfirmationDialoug = document.querySelector(".dockableContainer .activeFeature .stateBody .dialogState .dialogTextContainer");
						snapInhelpBtnDisabled = document.querySelector(".embeddedServiceHelpButton .helpButton .helpButtonDisabled");
						snapInhelpBtnEnabled = document.querySelector(".embeddedServiceHelpButton .helpButton .helpButtonEnabled");
						snapInEmbeddedServiceHelpBtn = document.querySelector(".embeddedServiceHelpButton");
						if (snapInPrechatForm && snapInCurrentPage != "snapInPrechatForm") {
							lagCounter(snapInCurrentPage ,"snapInPrechatForm");
							snapInCurrentPage = "snapInPrechatForm";
							document.querySelector(".startButton").click();
						} else if (snapInWaiting && snapInCurrentPage != "snapInWaiting") {
							lagCounter(snapInCurrentPage ,"snapInWaiting");
							snapInCurrentPage = "snapInWaiting";
						}else if (snapInQueueAssignment && snapInCurrentPage != "snapInQueueAssignment"){
							lagCounter(snapInCurrentPage ,"snapInQueueAssignment");
							snapInCurrentPage = "snapInQueueAssignment"; 
						} else if (snapInChatEnded && snapInCurrentPage != "snapInChatEnded") {//Fix for defect 7030965
							lagCounter(snapInCurrentPage ,"snapInChatEnded");
							snapInCurrentPage = "snapInChatEnded";
						} else if (snapInConfirmationDialoug && snapInCurrentPage != "snapInConfirmationDialoug") {
							lagCounter(snapInCurrentPage ,"snapInConfirmationDialoug");
							snapInCurrentPage = "snapInConfirmationDialoug";
						} else if (snapInEmbeddedServiceHelpBtn && window.getComputedStyle(snapInEmbeddedServiceHelpBtn).display === 'block') {
							if (snapInhelpBtnDisabled && window.getComputedStyle(snapInhelpBtnDisabled).display === 'flex' && snapInCurrentPage != "snapInhelpBtnDisabled") {
								lagCounter(snapInCurrentPage ,"snapInhelpBtnDisabled");
								snapInCurrentPage = "snapInhelpBtnDisabled";
							} else if (snapInhelpBtnEnabled && window.getComputedStyle(snapInhelpBtnEnabled).display === 'flex' && snapInCurrentPage != "snapInhelpBtnEnabled") {
								lagCounter(snapInCurrentPage ,"snapInhelpBtnEnabled");
								if(snapInCurrentPage == 'snapInhelpBtnDisabled')
									document.querySelector(".uiButton.helpButtonEnabled").click();
								snapInCurrentPage = "snapInhelpBtnEnabled";
							}
						}
					}
				});
			}
			var observer = new MutationObserver(attributeChangeCallback);
			var domElement = document.querySelector(eleSelector);
			observer.observe(domElement, {
				childList: true,
				subtree: true
			});
		} catch (e) { console.log('Error in Observer - ' + e) }
	}
</script>
</head>
<body>
  <h1>Basic Chat Code</h1>  
  <div><span>SFDC URL: </span>https://dellservices--0803ccks.my.salesforce.com</div>
  <style type='text/css'>
	.embeddedServiceHelpButton .helpButton .uiButton {
		background-color: #007db8;
		font-family: "Roboto Regular", sans-serif;
	}
	.embeddedServiceHelpButton .helpButton .uiButton:focus {
		outline: 1px solid #007db8;
	}
</style>

<script type='text/javascript' src='https://test-service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script type='text/javascript'>
	var initESW = function(gslbBaseURL) {
		embedded_svc.settings.displayHelpButton = true; //Or false
		embedded_svc.settings.language = ''; //For example, enter 'en' or 'en-US'

		//embedded_svc.settings.defaultMinimizedText = '...'; //(Defaults to Chat with an Expert)
		//embedded_svc.settings.disabledMinimizedText = '...'; //(Defaults to Agent Offline)

		//embedded_svc.settings.loadingText = ''; //(Defaults to Loading)
		//embedded_svc.settings.storageDomain = 'yourdomain.com'; //(Sets the domain for your deployment so that visitors can navigate subdomains during a chat session)

		// Settings for Chat
		//embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
			// Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
			// Returns a valid button ID.
		//};
		//embedded_svc.settings.prepopulatedPrechatFields = {}; //Sets the auto-population of pre-chat form fields
		//embedded_svc.settings.fallbackRouting = []; //An array of button IDs, user IDs, or userId_buttonId
		//embedded_svc.settings.offlineSupportMinimizedText = '...'; //(Defaults to Contact Us)
		embedded_svc.settings.prepopulatedPrechatFields = {
			FirstName: 'FN',
			LastName: 'LN',
			Email: 'email@test.com',
			Primary_Phone__c: '12345',
			Issue_Description__c: 'Test Description'
		};

		embedded_svc.settings.enabledFeatures = ['LiveAgent'];
		embedded_svc.settings.entryFeature = 'LiveAgent';

		embedded_svc.init(
			'https://dellservices--0803ccks.my.salesforce.com',
			'https://0803ccks-dellservices.cs41.force.com/LASnapIn',
			gslbBaseURL,
			'00D550000001KdZ',
			'Snap_Ins_Chat_Deployment',
			{
				baseLiveAgentContentURL: 'https://c.la1-c1cs-ia2.salesforceliveagent.com/content',
				deploymentId: '5720b000000GneC',
				buttonId: '5730b000000CbhT',
				baseLiveAgentURL: 'https://d.la1-c1cs-ia2.salesforceliveagent.com/chat',
				eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I0b000000blJJEAY_16520d15b68',
				isOfflineSupportEnabled: false
			}
		);
		domObserver("body");
	};

	if (!window.embedded_svc) {
		var s = document.createElement('script');
		s.setAttribute('src', 'https://dellservices--0803ccks.my.salesforce.com/embeddedservice/5.0/esw.min.js');
		s.onload = function() {
			initESW(null);
		};
		document.body.appendChild(s);
	} else {
		initESW('https://test-service.force.com');
	}
</script>
</body>
</html>
